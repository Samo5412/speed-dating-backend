# User Profiles API Endpoints
@baseUrl = http://localhost:3000/api/v1

# Make sure rest-client.rememberCookiesForSubsequentRequests is set to false in VS Code 
# settings to properly test unauthorized requests

###############################################
// User Creation Endpoint
###############################################

### Create a test user first
// Expected HTTP response status code: 201
// Expected response: a user object (json)
# @name createUser
POST {{baseUrl}}/users/register
Content-Type: application/json

{
    "fullName": "Bruce Wayne",
    "email": "profileuser4@example.com",
    "password": "password123"
}

### Create another test user
// Expected HTTP response status code: 201
// Expected response: a user object (json)
# @name createSecondUser
POST {{baseUrl}}/users/register
Content-Type: application/json

{
    "fullName": "Clark Kent",
    "email": "profileuser5@example.com",
    "password": "password123"
}

###############################################

### Store the user IDs as variables
@userId = {{createUser.response.body.userId}}
@secondUserId = {{createSecondUser.response.body.userId}}

###############################################
// Profile Management Endpoints
###############################################

### Try to update a profile when not authenticated
// Expected HTTP response status code: 401
// Expected response: "Unauthorized" error
PUT {{baseUrl}}/userProfiles/{{userId}}
Content-Type: application/json

{
    "userId": "{{userId}}",
    "fullName": "Test Name1",
    "dateOfBirth": "2001-01-01",
    "gender": "man",
    "phoneNumber": "0761234567",
    "occupation": "Software Developer",
    "bio": "A short bio",
    "interests": ["coding", "hiking"],
    "lookingFor": {
        "ageRange": "25-45",
        "personality": "outgoing",
        "relationshipType": "long-term"
    }
}

### Login a user
// Expected HTTP response status code: 200
// Expected response: a user object (json)
# @name loginUser
POST {{baseUrl}}/users/login
Content-Type: application/json

{
    "email": "profileuser5@example.com",
    "password": "password123"
}

###

@authCookie = {{loginUser.response.headers.set-cookie}}

### Update profile for the user using the user id
// Expected HTTP response status code: 200
// Expected response: the updated profile object (json)
# @name updateProfile
PUT {{baseUrl}}/userProfiles/{{userId}}
Content-Type: application/json
Cookie: {{authCookie}}

{
    "userId": "{{userId}}",
    "fullName": "Test Name1",
    "dateOfBirth": "2001-01-01",
    "gender": "man",
    "phoneNumber": "0761234567",
    "occupation": "Software Developer",
    "bio": "A short bio",
    "interests": ["coding", "hiking"],
    "lookingFor": {
        "ageRange": "25-45",
        "personality": "outgoing",
        "relationshipType": "long-term"
    }
}

### Try to create profile with non-existent user ID
// Expected HTTP response status code: 404
// Expected response: "User not found" error
POST {{baseUrl}}/userProfiles
Content-Type: application/json
Cookie: {{authCookie}}

{
    "userId": "65cccccccccccccccccccccc",
    "fullName": "This user does not exist",
    "dateOfBirth": "2000-01-01",
    "gender": "man"
}

### Try to create a second profile for the same user
// Expected HTTP response status code: 400
// Expected response: "User already has a profile" error
POST {{baseUrl}}/userProfiles
Content-Type: application/json
Cookie: {{authCookie}}

{
    "userId": "{{userId}}",
    "fullName": "Test Users Second Profile",
    "gender": "man"
}

### Update the profile for the second user
// Expected HTTP response status code: 200
// Expected response: the updated profile object (json)
# @name updateSecondProfile
PUT {{baseUrl}}/userProfiles/{{secondUserId}}
Content-Type: application/json
Cookie: {{authCookie}}

{
    "userId": "{{secondUserId}}",
    "fullName": "Test User2",
    "dateOfBirth": "1992-01-01",
    "gender": "woman",
    "interests": ["reading", "travel"]
}

###############################################

### Get all profiles
// Expected HTTP response status code: 200
// Expected response: an array (json) with all profiles
GET {{baseUrl}}/userProfiles
Cookie: {{authCookie}}

###############################################

### Get specific profile
// Expected HTTP response status code: 200
// Expected response: a profile object (json)
GET {{baseUrl}}/userProfiles/{{userId}}
Cookie: {{authCookie}}

### Try to get non-existent profile
// Expected HTTP response status code: 404
// Expected response: "Profile not found" error
GET {{baseUrl}}/userProfiles/65cccccccccccccccccccccc
Cookie: {{authCookie}}

###############################################

### Update profile
// Expected HTTP response status code: 200
// Expected response: the updated profile object (json)
PUT {{baseUrl}}/userProfiles/{{userId}}
Content-Type: application/json
Cookie: {{authCookie}}

{
    "userId": "{{userId}}",
    "fullName": "Test Name1 Updated",
    "bio": "Updated bio",
    "interests": ["coding", "hiking", "gaming"]
}

### Try to update non-existent profile
// Expected HTTP response status code: 404
// Expected response: "Profile not found" error
PUT {{baseUrl}}/userProfiles/65cccccccccccccccccccccc
Content-Type: application/json
Cookie: {{authCookie}}

{
    "fullName": "Not Found User",
    "bio": "This should fail"
}

###############################################

### Delete the profile
// Expected HTTP response status code: 200
// Expected response: "Profile deleted"
DELETE {{baseUrl}}/userProfiles/{{userId}}
Cookie: {{authCookie}}

### Try to delete already deleted profile
// Expected HTTP response status code: 404
// Expected response: "Profile not found" error
DELETE {{baseUrl}}/userProfiles/{{userId}}
Cookie: {{authCookie}}

### Delete the second profile
// Expected HTTP response status code: 200
// Expected response: "Profile deleted"
DELETE {{baseUrl}}/userProfiles/{{secondUserId}}
Cookie: {{authCookie}}

###############################################
// Cleanup Endpoints
###############################################

### Delete the first user
// Expected HTTP response status code: 200
// Expected response: "User deleted"
DELETE {{baseUrl}}/users/{{userId}}
Cookie: {{authCookie}}

### Delete the second user
// Expected HTTP response status code: 200
// Expected response: "User deleted"
DELETE {{baseUrl}}/users/{{secondUserId}}
Cookie: {{authCookie}}
